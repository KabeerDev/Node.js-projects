<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <title>Admin</title>
</head>

<body>
    <%- include('components/nav'); %>

        <h1 class="text-center text-success fw-bold mt-4">All Candidates</h1>

        <div class="bg-success text-white mb-3 p-2 text-center success_msg"></div>

        <div class="container">
            <a href="/admin/add-candidate" class="btn btn-success"><svg xmlns="http://www.w3.org/2000/svg" width="25"
                    height="25" fill="#fff" class="bi bi-plus" viewBox="0 0 16 16">
                    <path
                        d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                </svg> Add A New Candidate</a>
            <% if(allCandidates.length> 0){ %>
                <table class="table w-75 mx-auto my-4 border border-dark table-info table-striped">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Name</th>
                            <th scope="col">Party</th>
                            <th scope="col">Votes</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% allCandidates.forEach(candidate=> { %>
                            <tr>
                                <th scope="row">
                                    <%= s_no++ %>
                                </th>
                                <td>
                                    <%= candidate.name %>
                                </td>
                                <td>
                                    <%= candidate.party%>
                                </td>
                                <td>
                                    <%= candidate.voteCount %>
                                </td>
                                <td class="">
                                    <a class="btn btn-sm btn-info text-white mb-1"
                                        href="/admin/edit-candidate/<%= candidate._id %>">Edit</a>
                                    <button class="btn btn-sm btn-danger delete_btn"
                                        id="<%= candidate._id %>">Delete</button>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>
                <% }else { %>
                    <div class="my-4 fs-1 text-center text-success fw-semibold">No Candidates Yet!</div>
                    <% }; %>
        </div>
        <%- include('../components/footer'); %>
            <script>
                $(".success_msg").hide();

                $(".delete_btn").click(function () {
                    const id = this.id;
                    $.ajax({
                        url: `/admin/delete-candidate`,
                        type: "DELETE",
                        data: { id },
                        success: function (data) {
                            $(".success_msg").fadeIn();
                            $(".success_msg").text(data.message);
                            setTimeout(() => {
                                $(".success_msg").fadeOut();
                            }, 2000);
                        }
                    });
                    $(this).closest("tr").fadeOut();
                });
            </script>
</body>

</html>